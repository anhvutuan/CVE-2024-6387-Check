"use client";

import { Check, Copy, Terminal } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useState, useEffect, useRef } from "react";
import { toast } from "sonner";

export default function HeroContainer() {
  const [isCopied, setIsCopied] = useState(false);
  const textToCopy =
    "wget https://static.devarshi.dev/cve-2024-6387/check.sh && chmod +x ./check.sh && ./check.sh";
  const timeoutRef = useRef<NodeJS.Timeout | null>(null);

  const handleCopy = () => {
    navigator.clipboard.writeText(textToCopy);
    setIsCopied(true);

    toast("Command copied!", {
      description: textToCopy,
      icon: <Check className="w-4 h-4 mr-2" />,
    });

    if (timeoutRef.current !== null) {
      clearTimeout(timeoutRef.current);
    }

    timeoutRef.current = setTimeout(() => {
      setIsCopied(false);
    }, 2000);
  };

  useEffect(() => {
    return () => clearTimeout(timeoutRef.current!);
  }, []);

  return (
    <section className="pt-12 bg-gray-50 sm:pt-16">
      <div className="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
        <div className="max-w-2xl mx-auto text-center">
          <h1 className="mt-5 text-4xl font-bold leading-tight text-slate-900 sm:leading-tight sm:text-5xl lg:text-6xl lg:leading-tight">
            CVE-2024-6387 Checker
          </h1>
        </div>
        <div className="max-w-4xl mx-auto text-center">
          <h2 className="px-6 text-lg text-slate-600">
            CVE-2024-6387 Checker is a fast, efficient tool for detecting
            OpenSSH servers vulnerable to the regreSSHion exploit. It quickly
            scans multiple IPs, domain names, and CIDR ranges to identify risks
            and help secure your infrastructure.
          </h2>
        </div>
      </div>
      <div className="flex justify-center items-center w-full">
        <div className="mt-9 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium text-slate-900 border-2 bg-white border-gray-400 pl-4 pr-2">
          <Terminal className="w-5 h-5 mr-2 md:mr-5" />
          <p className="font-mono mr-0 md:mr-5">{textToCopy}</p>
          <Button variant="ghost" size="icon" onClick={handleCopy}>
            {isCopied ? (
              <Check className="w-3 md:w-4 h-3 md:h-4" />
            ) : (
              <Copy className="w-4 h-4" />
            )}
          </Button>
        </div>
      </div>
    </section>
  );
}
